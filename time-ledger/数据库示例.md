# æ•°æ®åº“ç¤ºä¾‹æ•°æ®

æœ¬æ–‡æ¡£å±•ç¤ºäº† Time Ledger ç³»ç»Ÿä¸­å„ä¸ªæ ¸å¿ƒè¡¨çš„**å®Œæ•´ç¤ºä¾‹æ•°æ®**ï¼ˆæˆªè‡³ 2026-01-26ï¼‰ï¼Œå¹¶è¯¦ç»†è¯´æ˜äº†å­—æ®µå«ä¹‰ã€ä¸šåŠ¡é€»è¾‘åŠå¹‚ç­‰æ€§è®¾è®¡ã€‚

> **æ•°æ®è¯´æ˜**ï¼š
> 1. æ•°æ®æ¶µç›– **Sepolia (11155111)** å’Œ **Base Sepolia (84532)** ä¸¤æ¡é“¾ã€‚
> 2. ä¸ºä¿è¯è¡¨æ ¼å¯è¯»æ€§ï¼Œé•¿å­—ç¬¦ä¸²ï¼ˆåœ°å€/å“ˆå¸Œï¼‰è¿›è¡Œäº†è„±æ•æ˜¾ç¤ºï¼ˆå¦‚ `0x8a89...5Dd1`ï¼‰ï¼Œä½†**è¡Œæ•°å®Œæ•´ï¼Œæ— é—æ¼**ã€‚
> 3. æ‰€æœ‰æ•°æ®æ¥è‡ªçœŸå®è¿è¡Œçš„ç³»ç»Ÿï¼ˆtimeledger.jsonï¼‰ã€‚

---

## 1. balance_log (ä½™é¢å˜åŠ¨äº‹å®è¡¨)

è®°å½•æ‰€æœ‰ ERC20 Transfer äº‹ä»¶å¯¼è‡´çš„ä½™é¢å˜åŠ¨æµæ°´ã€‚è¿™æ˜¯è®¡ç®—ä½™é¢å’Œç§¯åˆ†çš„**åŸå§‹äº‹å®æº**ã€‚

| id | chain_id | contract_address | account | delta | balance_after | block_number | block_time | tx_hash | log_index | created_at |
|---|---|---|---|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 1000 | 1000 | 10032846 | 2026-01-13 05:20:36 | 0x8a68...52b0 | 657 | 2026-01-26 05:19:53 |
| 2 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 1000 | 1000 | 36258216 | 2026-01-13 06:12:00 | 0x8d18...4732 | 66 | 2026-01-26 05:20:19 |
| 3 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -100 | 900 | 10034697 | 2026-01-13 11:59:12 | 0x83ed...fc49 | 43 | 2026-01-26 05:24:30 |
| 4 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 100 | 100 | 10034697 | 2026-01-13 11:59:12 | 0x83ed...fc49 | 43 | 2026-01-26 05:24:30 |
| 5 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -150 | 750 | 10034699 | 2026-01-13 11:59:48 | 0x3595...8ecf | 31 | 2026-01-26 05:24:31 |
| 6 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 150 | 150 | 10034699 | 2026-01-13 11:59:48 | 0x3595...8ecf | 31 | 2026-01-26 05:24:31 |
| 7 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -90 | 660 | 10038756 | 2026-01-14 01:54:48 | 0x671e...2117 | 123 | 2026-01-26 05:52:33 |
| 8 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 90 | 190 | 10038756 | 2026-01-14 01:54:48 | 0x671e...2117 | 123 | 2026-01-26 05:52:33 |
| 9 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -160 | 500 | 10038757 | 2026-01-14 01:55:00 | 0x2104...a6e8 | 48 | 2026-01-26 05:52:33 |
| 10 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 160 | 310 | 10038757 | 2026-01-14 01:55:00 | 0x2104...a6e8 | 48 | 2026-01-26 05:52:33 |
| 11 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | -110 | 890 | 36268659 | 2026-01-13 12:00:06 | 0x17be...7387 | 107 | 2026-01-26 05:59:16 |
| 12 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 110 | 110 | 36268659 | 2026-01-13 12:00:06 | 0x17be...7387 | 107 | 2026-01-26 05:59:16 |
| 13 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | -130 | 760 | 36268682 | 2026-01-13 12:00:52 | 0xef0c...45e0 | 24 | 2026-01-26 05:59:17 |
| 14 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 130 | 130 | 36268682 | 2026-01-13 12:00:52 | 0xef0c...45e0 | 24 | 2026-01-26 05:59:17 |
| 15 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -310 | 190 | 10046276 | 2026-01-15 03:01:00 | 0x97cc...4a8e | 2 | 2026-01-26 06:25:34 |
| 16 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 310 | 500 | 10046276 | 2026-01-15 03:01:00 | 0x97cc...4a8e | 2 | 2026-01-26 06:25:34 |
| 17 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -70 | 120 | 10046278 | 2026-01-15 03:01:24 | 0x3e6e...1e12 | 3 | 2026-01-26 06:25:35 |
| 18 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 70 | 380 | 10046278 | 2026-01-15 03:01:24 | 0x3e6e...1e12 | 3 | 2026-01-26 06:25:35 |
| 19 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | -70 | 430 | 10053039 | 2026-01-16 01:47:24 | 0x2081...b2d3 | 25 | 2026-01-26 06:35:26 |
| 20 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 70 | 450 | 10053039 | 2026-01-16 01:47:24 | 0x2081...b2d3 | 25 | 2026-01-26 06:35:26 |

**å…³é”®å­—æ®µè¯´æ˜**ï¼š
* `delta`: ä½™é¢å˜åŠ¨é‡ï¼ˆæ­£æ•°=å…¥è´¦ï¼Œè´Ÿæ•°=å‡ºè´¦ï¼‰ã€‚æ•°æ®å­˜å‚¨ä¸º weiï¼Œå±•ç¤ºæ—¶é™¤ä»¥ 10^18ã€‚
* `balance_after`: å˜åŠ¨å‘ç”Ÿåçš„ä½™é¢å¿«ç…§ã€‚
* `log_index`: åŒºå—å†…çš„æ—¥å¿—ç´¢å¼•ï¼Œç”¨äºåŒºåˆ†åŒä¸€äº¤æ˜“ä¸­çš„å¤šç¬”è½¬è´¦ã€‚
* `tx_hash`: äº¤æ˜“å“ˆå¸Œï¼Œå¯åœ¨åŒºå—æµè§ˆå™¨æŸ¥è¯¢ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
```sql
UNIQUE KEY idx_balance_log (chain_id, contract_address, tx_hash, log_index, account)
```
**ä½œç”¨**ï¼šä¿è¯é“¾ä¸Šæ¯ä¸€ç¬”è½¬è´¦äº‹ä»¶ï¼ˆTransferï¼‰åœ¨æ•°æ®åº“ä¸­åªè¢«è®°å½•ä¸€æ¬¡ã€‚å³ä½¿ Indexer é‡å¤æ‰«æåŒºå—ï¼Œæ•°æ®åº“ä¹Ÿä¼šè‡ªåŠ¨å¿½ç•¥é‡å¤è®°å½•ã€‚

**ä¸šåŠ¡é€»è¾‘**ï¼š
- æ¯ç¬” Transfer äº‹ä»¶äº§ç”Ÿ 2 æ¡è®°å½•ï¼šå‘é€æ–¹ï¼ˆdelta ä¸ºè´Ÿï¼‰å’Œæ¥æ”¶æ–¹ï¼ˆdelta ä¸ºæ­£ï¼‰
- Mint æ“ä½œï¼šåªæœ‰æ¥æ”¶æ–¹è®°å½•ï¼ˆå¦‚ id=1, 2ï¼‰
- æ™®é€šè½¬è´¦ï¼šå‘é€æ–¹å’Œæ¥æ”¶æ–¹å„ä¸€æ¡ï¼ˆå¦‚ id=3, 4 æ¥è‡ªåŒä¸€ç¬”äº¤æ˜“ï¼‰

---

## 2. block_cursor (åŒæ­¥è¿›åº¦è¡¨)

è®°å½•æ¯æ¡é“¾çš„ Indexer å·¥ä½œè¿›åº¦ã€‚

| id | chain_id | contract_address | block_number | block_hash | scan_block_number | last_block_time | updated_at |
|---|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 10126310 | 0x8133...7764 | 10126310 | 2026-01-26 08:26:36 | 2026-01-26 08:29:21 |
| 2 | 84532 | 0xB8a3...3dF6 | 36268682 | 0x6154...b008 | 36282866 | 2026-01-13 19:53:40 | 2026-01-26 08:31:24 |

**å…³é”®å­—æ®µè¯´æ˜**ï¼š
* `block_number`: **å…¥åº“é«˜åº¦**ã€‚è¡¨ç¤ºè¯¥é«˜åº¦åŠä¹‹å‰çš„äº¤æ˜“å·²å…¨éƒ¨å†™å…¥æ•°æ®åº“ï¼ˆcanonicalï¼‰ã€‚
* `scan_block_number`: **æ‰«æé«˜åº¦**ã€‚è¡¨ç¤º Indexer å·²ç»æ£€æŸ¥è¿‡çš„åŒºå—é«˜åº¦ï¼ˆå¯èƒ½åŒ…å«ç©ºå—ï¼‰ã€‚
* `last_block_time`: **æœ€æ–°å®‰å…¨æ—¶é—´**ã€‚Calculator ä¾èµ–æ­¤å­—æ®µåˆ¤æ–­"ç°åœ¨"çš„æ—¶é—´ã€‚

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **OP Stack æ‰«æè¿›åº¦é¢†å…ˆ**ï¼šæ³¨æ„ Chain 84532 çš„ `scan_block_number` (36282866) è¿œå¤§äº `block_number` (36268682)ã€‚è¿™æ˜¯å› ä¸º OP Stack é“¾åŒ…å«å¤§é‡ç©ºå—ï¼ŒIndexer å·²ç»æ‰«æç¡®è®¤äº†åç»­çš„ç©ºå—å¹¶æ›´æ–°äº†æ—¶é—´ï¼Œä½†ç”±äºæ²¡æœ‰æ–°äº¤æ˜“ï¼Œå…¥åº“é«˜åº¦ä¿æŒä¸å˜ã€‚
* **Sepolia åŒæ­¥æœ€æ–°**ï¼šChain 11155111 çš„ä¸¤ä¸ªé«˜åº¦ç›¸åŒï¼Œè¯´æ˜å·²åŒæ­¥åˆ°æœ€æ–°åŒºå—ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
```sql
UNIQUE KEY idx_block_cursor (chain_id, contract_address)
```
**ä½œç”¨**ï¼šç¡®ä¿æ¯ä¸ªåˆçº¦åœ¨æ¯æ¡é“¾ä¸Šåªæœ‰ä¸€è¡Œè¿›åº¦è®°å½•ï¼Œé˜²æ­¢å¹¶å‘ Indexer å®ä¾‹å¯¼è‡´çŠ¶æ€åˆ†è£‚ã€‚

---

## 3. block_header (åŒºå—å¤´ä¿¡æ¯è¡¨)

å­˜å‚¨å…³é”®çš„åŒºå—å“ˆå¸Œä¿¡æ¯ï¼Œç”¨äºæ£€æµ‹é“¾åˆ†å‰ï¼ˆReorgï¼‰ã€‚

| id | chain_id | contract_address | block_number | block_hash | parent_hash | block_time | created_at |
|---|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 10032846 | 0x8b3f...0ac5 | 0xf574...5142 | 2026-01-13 05:20:36 | 2026-01-26 05:19:53 |
| 2 | 84532 | 0xB8a3...3dF6 | 36258216 | 0x3cf5...7eac | 0xcdcf...ba29 | 2026-01-13 06:12:00 | 2026-01-26 05:20:19 |
| 3 | 11155111 | 0xBEfe...C073 | 10034697 | 0x60f5...1860 | 0x7ee6...8560 | 2026-01-13 11:59:12 | 2026-01-26 05:24:30 |
| 4 | 11155111 | 0xBEfe...C073 | 10034699 | 0x09ae...d16b | 0x514f...cd0a | 2026-01-13 11:59:48 | 2026-01-26 05:24:31 |
| 5 | 11155111 | 0xBEfe...C073 | 10038756 | 0xb239...0452 | 0xd3ed...3042 | 2026-01-14 01:54:48 | 2026-01-26 05:52:33 |
| 6 | 11155111 | 0xBEfe...C073 | 10038757 | 0x2388...bd61 | 0xb239...0452 | 2026-01-14 01:55:00 | 2026-01-26 05:52:33 |
| 7 | 84532 | 0xB8a3...3dF6 | 36268659 | 0xb493...e231 | 0x6904...1aae | 2026-01-13 12:00:06 | 2026-01-26 05:59:16 |
| 8 | 84532 | 0xB8a3...3dF6 | 36268682 | 0x6154...b008 | 0x0af9...7bed | 2026-01-13 12:00:52 | 2026-01-26 05:59:17 |
| 9 | 11155111 | 0xBEfe...C073 | 10046276 | 0x6c7f...3afd | 0x6284...a4e0 | 2026-01-15 03:01:00 | 2026-01-26 06:25:34 |
| 10 | 11155111 | 0xBEfe...C073 | 10046278 | 0xb209...3d12 | 0xa682...4688 | 2026-01-15 03:01:24 | 2026-01-26 06:25:35 |
| 11 | 11155111 | 0xBEfe...C073 | 10053039 | 0x8b26...8718 | 0x25d2...bbd2 | 2026-01-16 01:47:24 | 2026-01-26 06:35:26 |

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **åˆ†å‰æ£€æµ‹**ï¼šIndexer å®šæœŸå¯¹æ¯”æœ¬åœ° `block_hash` ä¸é“¾ä¸Š RPC è¿”å›çš„ Hashã€‚å¦‚æœä¸ä¸€è‡´ï¼Œè¯´æ˜å‘ç”Ÿ Reorgï¼Œè§¦å‘å›æ»šé€»è¾‘ã€‚
* **è®°å½•å¯†åº¦**ï¼šä»…è®°å½•**æœ‰äº¤æ˜“**çš„åŒºå—å¤´ï¼Œä»¥èŠ‚çœç©ºé—´ã€‚
* **çˆ¶å“ˆå¸ŒéªŒè¯**ï¼šé€šè¿‡ `parent_hash` å¯ä»¥éªŒè¯åŒºå—é“¾çš„è¿ç»­æ€§ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
```sql
UNIQUE KEY idx_block_header (chain_id, contract_address, block_number)
```
**ä½œç”¨**ï¼šä¿è¯æ¯ä¸ªåŒºå—é«˜åº¦åªå­˜å‚¨ä¸€ä¸ª Headerã€‚å½“å‘ç”Ÿé‡ç»„æ—¶ï¼Œéœ€å…ˆåˆ é™¤æ—§ Header å†æ’å…¥æ–° Headerã€‚

---
## 4. point_rate (ç§¯åˆ†è´¹ç‡è¡¨)

é…ç½®ä¸åŒæ—¶é—´æ®µçš„ç§¯åˆ†äº§ç”Ÿé€Ÿç‡ã€‚

| id | chain_id | contract_address | rate_numerator | rate_denominator | effective_time | created_at |
|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 5 | 100 | 1970-01-01 00:00:00 | 2026-01-26 05:19:44 |
| 2 | 11155111 | 0xBEfe...C073 | 8 | 100 | 2026-01-15 03:01:00 | 2026-01-26 05:19:44 |
| 3 | 84532 | 0xB8a3...3dF6 | 5 | 100 | 1970-01-01 00:00:00 | 2026-01-26 05:19:44 |
| 4 | 84532 | 0xB8a3...3dF6 | 8 | 100 | 2026-01-15 03:01:00 | 2026-01-26 05:19:44 |

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **è´¹ç‡è®¡ç®—**ï¼š`rate = rate_numerator / rate_denominator` (ä¾‹: 5/100 = 5% å¹´åŒ–)ã€‚
* **æ—¶é—´åˆ‡ç‰‡**ï¼šç§¯åˆ†è®¡ç®—å™¨åœ¨è®¡ç®—æ—¶ï¼Œä¼šæ ¹æ® `effective_time` å°†æ—¶é—´è½´åˆ‡åˆ†ä¸ºä¸åŒåŒºé—´ï¼Œåº”ç”¨ä¸åŒçš„è´¹ç‡ã€‚
* **è´¹ç‡å˜æ›´**ï¼š2026-01-15 03:01:00 ä¹‹å‰ä½¿ç”¨ 5%ï¼Œä¹‹åä½¿ç”¨ 8%ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
```sql
UNIQUE KEY idx_point_rate (chain_id, contract_address, effective_time)
```
**ä½œç”¨**ï¼šé˜²æ­¢åŒä¸€æ—¶é—´ç‚¹å­˜åœ¨å†²çªçš„è´¹ç‡é…ç½®ï¼Œç¡®ä¿ç§¯åˆ†è®¡ç®—çš„ç¡®å®šæ€§ã€‚

---

## 5. user_balance (ç”¨æˆ·ä½™é¢å¿«ç…§è¡¨)

å­˜å‚¨ç”¨æˆ·å½“å‰æ—¶åˆ»çš„ä½™é¢çŠ¶æ€ï¼ˆçƒ­æ•°æ®ï¼‰ã€‚

| id | chain_id | contract_address | account | balance | block_number | block_time | updated_at |
|---|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 120 | 10046278 | 2026-01-15 03:01:24 | 2026-01-26 06:25:35 |
| 2 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 760 | 36268682 | 2026-01-13 12:00:52 | 2026-01-26 05:59:17 |
| 3 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 430 | 10053039 | 2026-01-16 01:47:24 | 2026-01-26 06:35:26 |
| 4 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 450 | 10053039 | 2026-01-16 01:47:24 | 2026-01-26 06:35:26 |
| 5 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 110 | 36268659 | 2026-01-13 12:00:06 | 2026-01-26 05:59:16 |
| 6 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 130 | 36268682 | 2026-01-13 12:00:52 | 2026-01-26 05:59:17 |

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **å®æ—¶æ€§**ï¼šæ¯æ¬¡ Indexer å¤„ç†ä¸€ä¸ªå—ï¼Œéƒ½ä¼šæ›´æ–°æ­¤è¡¨ã€‚
* **å¯é‡å»ºæ€§**ï¼šæ­¤è¡¨å¯éšæ—¶é€šè¿‡ `balance_log` é‡å»ºã€‚å½“å‘ç”Ÿåˆ†å‰å›æ»šæ—¶ï¼Œç³»ç»Ÿä¼šåˆ é™¤æ—§å¿«ç…§å¹¶åˆ©ç”¨ log é‡ç®—ã€‚
* **æŸ¥è¯¢ä¼˜åŒ–**ï¼šAPI æŸ¥è¯¢ä½™é¢æ—¶ç›´æ¥è¯»å–æ­¤è¡¨ï¼Œæ— éœ€ç´¯åŠ  balance_logã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
```sql
UNIQUE KEY idx_user_balance (chain_id, contract_address, account)
```
**ä½œç”¨**ï¼šä¿è¯æ¯ä¸ªç”¨æˆ·åœ¨æ¯ä¸ªåˆçº¦ä¸‹åªæœ‰ä¸€æ¡ä½™é¢è®°å½•ï¼Œæ”¯æŒå¿«é€Ÿè¦†ç›–æ›´æ–°ã€‚

---

## 6. user_point (ç”¨æˆ·ç§¯åˆ†å¿«ç…§è¡¨)

å­˜å‚¨ç”¨æˆ·å½“å‰ç´¯è®¡çš„æ€»ç§¯åˆ†ã€‚

| id | chain_id | contract_address | account | total_points | last_calc_time | updated_at |
|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 10065.242 | 2026-01-26 08:26:36 | 2026-01-26 11:13:12 |
| 2 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 4068.635 | 2026-01-26 08:26:36 | 2026-01-26 11:13:12 |
| 3 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 9703.923 | 2026-01-26 08:26:36 | 2026-01-26 11:13:12 |
| 4 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 590.092 | 2026-01-13 19:53:40 | 2026-01-26 11:13:12 |
| 5 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 51.220 | 2026-01-13 19:53:40 | 2026-01-26 11:13:12 |
| 6 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 43.410 | 2026-01-13 19:53:40 | 2026-01-26 11:13:12 |

**å…³é”®å­—æ®µè¯´æ˜**ï¼š
* `total_points`: ç”¨æˆ·å†å²æ€»ç§¯åˆ†ã€‚
* `last_calc_time`: **ç§¯åˆ†ç»“ç®—æ°´ä½çº¿**ã€‚ä¸‹æ¬¡è®¡ç®—å°†ä»è¿™ä¸ªæ—¶é—´ç‚¹å¼€å§‹ã€‚
* **æ³¨æ„**ï¼šSepolia é“¾å·²è®¡ç®—åˆ° 2026-01-26 08:26:36ï¼ŒBase Sepolia é“¾åªè®¡ç®—åˆ° 2026-01-13 19:53:40ï¼ˆå› ä¸º Indexer åŒæ­¥è¿›åº¦ä¸åŒï¼‰ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
```sql
UNIQUE KEY idx_user_point (chain_id, contract_address, account)
```
**ä½œç”¨**ï¼šæ¯ä¸ªç”¨æˆ·åªæœ‰ä¸€æ¡ç§¯åˆ†è®°å½•ã€‚Calculator é‡‡ç”¨ `INSERT ON DUPLICATE KEY UPDATE` é€»è¾‘æ›´æ–°æ­¤è¡¨ã€‚

---

## 7. user_point_log_1 (ç§¯åˆ†è®¡ç®—æ˜ç»†è¡¨ - Sepolia)

è®°å½• Sepolia é“¾ä¸Šæ¯ä¸€æ®µ"ä½™é¢ä¿æŒä¸å˜çš„æ—¶é—´åŒºé—´"æ‰€äº§ç”Ÿçš„ç§¯åˆ†ã€‚è¿™æ˜¯ç§¯åˆ†çš„**å®¡è®¡æ˜ç»†**ã€‚

**æ•°æ®é‡**ï¼š25 æ¡è®°å½•

**ç¤ºä¾‹æ•°æ®**ï¼ˆå‰ 10 æ¡ï¼‰ï¼š

| id | chain_id | contract_address | account | balance | from_time | to_time | points | rate_numerator | rate_denominator | created_at |
|---|---|---|---|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 150 | 2026-01-13 11:59:48 | 2026-01-14 01:55:00 | 104.400 | 5 | 100 | 2026-01-26 05:54:47 |
| 2 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 310 | 2026-01-14 01:55:00 | 2026-01-14 05:23:24 | 53.837 | 5 | 100 | 2026-01-26 05:54:47 |
| 3 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 1000 | 2026-01-13 05:20:36 | 2026-01-13 11:59:12 | 332.167 | 5 | 100 | 2026-01-26 05:54:47 |
| 4 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 900 | 2026-01-13 11:59:12 | 2026-01-13 11:59:48 | 0.450 | 5 | 100 | 2026-01-26 05:54:47 |
| 5 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 750 | 2026-01-13 11:59:48 | 2026-01-14 01:54:48 | 521.875 | 5 | 100 | 2026-01-26 05:54:47 |
| 6 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 660 | 2026-01-14 01:54:48 | 2026-01-14 01:55:00 | 0.110 | 5 | 100 | 2026-01-26 05:54:47 |
| 7 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 500 | 2026-01-14 01:55:00 | 2026-01-14 05:23:24 | 86.833 | 5 | 100 | 2026-01-26 05:54:47 |
| 8 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 100 | 2026-01-13 11:59:12 | 2026-01-14 01:54:48 | 69.633 | 5 | 100 | 2026-01-26 05:54:47 |
| 9 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 190 | 2026-01-14 01:54:48 | 2026-01-14 05:23:24 | 33.028 | 5 | 100 | 2026-01-26 05:54:47 |
| 10 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 310 | 2026-01-14 05:23:24 | 2026-01-15 03:01:00 | 335.213 | 5 | 100 | 2026-01-26 07:04:55 |

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **è¿ç»­æ€§**ï¼šå¯¹äºåŒä¸€ä¸ªç”¨æˆ·ï¼Œ`from_time` å¿…é¡»ä¸¥æ ¼ç­‰äºä¸Šä¸€æ¡è®°å½•çš„ `to_time`ã€‚
* **å®Œæ•´æ€§**ï¼šæ‰€æœ‰æ—¶é—´æ®µåŠ èµ·æ¥åº”è¦†ç›–ç”¨æˆ·æŒä»“çš„æ¯ä¸€ç§’ã€‚
* **è´¹ç‡åˆ‡æ¢**ï¼šå½“è·¨è¶Šè´¹ç‡å˜æ›´æ—¶é—´ç‚¹æ—¶ï¼Œä¼šæ‹†åˆ†ä¸ºä¸¤æ¡è®°å½•ï¼ˆå¦‚ id=10, 11ï¼‰ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
```sql
UNIQUE KEY idx_point_log (chain_id, contract_address, account, from_time, to_time)
```
**ä½œç”¨**ï¼šé˜²æ­¢åŒä¸€æ—¶é—´æ®µè¢«é‡å¤è®¡ç®—ç§¯åˆ†ã€‚

---

## 8. user_point_log_2 (ç§¯åˆ†è®¡ç®—æ˜ç»†è¡¨ - Base Sepolia)

è®°å½• Base Sepolia é“¾ä¸Šçš„ç§¯åˆ†è®¡ç®—æ˜ç»†ã€‚

**æ•°æ®é‡**ï¼š13 æ¡è®°å½•

**ç¤ºä¾‹æ•°æ®**ï¼ˆå…¨éƒ¨ï¼‰ï¼š

| id | chain_id | contract_address | account | balance | from_time | to_time | points | rate_numerator | rate_denominator | created_at |
|---|---|---|---|---|---|---|---|---|---|---|
| 1 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 1000 | 2026-01-13 06:12:00 | 2026-01-13 10:13:40 | 201.389 | 5 | 100 | 2026-01-26 05:54:47 |
| 2 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 1000 | 2026-01-13 10:13:40 | 2026-01-13 11:10:20 | 47.222 | 5 | 100 | 2026-01-26 05:56:59 |
| 3 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 130 | 2026-01-13 12:00:52 | 2026-01-13 12:27:00 | 2.831 | 5 | 100 | 2026-01-26 06:00:14 |
| 4 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 1000 | 2026-01-13 11:10:20 | 2026-01-13 12:00:06 | 41.472 | 5 | 100 | 2026-01-26 06:00:14 |
| 5 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 890 | 2026-01-13 12:00:06 | 2026-01-13 12:00:52 | 0.569 | 5 | 100 | 2026-01-26 06:00:14 |
| 6 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 760 | 2026-01-13 12:00:52 | 2026-01-13 12:27:00 | 16.551 | 5 | 100 | 2026-01-26 06:00:14 |
| 7 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 110 | 2026-01-13 12:00:06 | 2026-01-13 12:27:00 | 2.466 | 5 | 100 | 2026-01-26 06:00:14 |
| 8 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 130 | 2026-01-13 12:27:00 | 2026-01-13 19:03:40 | 42.972 | 5 | 100 | 2026-01-26 07:04:55 |
| 9 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 760 | 2026-01-13 12:27:00 | 2026-01-13 19:03:40 | 251.222 | 5 | 100 | 2026-01-26 07:04:55 |
| 10 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 110 | 2026-01-13 12:27:00 | 2026-01-13 19:03:40 | 36.361 | 5 | 100 | 2026-01-26 07:04:55 |
| 11 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 130 | 2026-01-13 19:03:40 | 2026-01-13 19:53:40 | 5.417 | 5 | 100 | 2026-01-26 11:13:12 |
| 12 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 760 | 2026-01-13 19:03:40 | 2026-01-13 19:53:40 | 31.667 | 5 | 100 | 2026-01-26 11:13:12 |
| 13 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 110 | 2026-01-13 19:03:40 | 2026-01-13 19:53:40 | 4.583 | 5 | 100 | 2026-01-26 11:13:12 |

**ä¸šåŠ¡é€»è¾‘**ï¼š
* Base Sepolia é“¾çš„ç§¯åˆ†è®¡ç®—åªåˆ° 2026-01-13 19:53:40ï¼Œå› ä¸º Indexer çš„ `last_block_time` åœç•™åœ¨æ­¤æ—¶é—´ã€‚
* æ‰€æœ‰è®°å½•ä½¿ç”¨ 5% è´¹ç‡ï¼Œå› ä¸ºè¿˜æœªåˆ°è¾¾è´¹ç‡å˜æ›´æ—¶é—´ç‚¹ï¼ˆ2026-01-15 03:01:00ï¼‰ã€‚

---

## 9. sys_chains (é“¾é…ç½®è¡¨)

ç³»ç»Ÿæ”¯æŒçš„åŒºå—é“¾é…ç½®ã€‚

| id | chain_id | name | type | rpc_env_key | confirmations | chunk_size | request_delay_ms | reorg_window | created_at | updated_at |
|---|---|---|---|---|---|---|---|---|---|---|
| 1 | 11155111 | sepolia | ethereum | SEPOLIA_RPC_URL | 6 | 10 | 100 | 200 | 2026-01-26 05:19:44 | 2026-01-26 05:45:35 |
| 2 | 84532 | base-sepolia | opstack | BASE_SEPOLIA_RPC_URL | 6 | 10 | 200 | 200 | 2026-01-26 05:19:44 | 2026-01-26 05:45:35 |

**å­—æ®µè¯´æ˜**ï¼š
* `type`: é“¾ç±»å‹ï¼ˆethereum / opstackï¼‰
* `rpc_env_key`: RPC URL å¯¹åº”çš„ç¯å¢ƒå˜é‡å
* `confirmations`: äº¤æ˜“ç¡®è®¤æ•°ï¼ˆä»¥å¤ªåŠé“¾ä½¿ç”¨ï¼‰
* `chunk_size`: æ¯æ¬¡åŒæ­¥çš„åŒºå—æ•°é‡
* `request_delay_ms`: è¯·æ±‚é—´éš”ï¼ˆæ¯«ç§’ï¼‰
* `reorg_window`: åŒºå—é‡ç»„æ£€æµ‹çª—å£ï¼ˆOP Stack é“¾ä½¿ç”¨ï¼‰

---

## 10. sys_contracts (åˆçº¦é…ç½®è¡¨)

ç³»ç»Ÿç›‘æ§çš„åˆçº¦é…ç½®ã€‚

| id | chain_id | name | address | start_block | token_decimals | is_enabled | created_at | updated_at |
|---|---|---|---|---|---|---|---|---|
| 1 | 11155111 | Default-Pool | 0xBEfe...C073 | 10032808 | 18 | 1 | 2026-01-26 05:19:44 | 2026-01-26 07:30:11 |
| 2 | 84532 | Default-Pool | 0xB8a3...3dF6 | 36257957 | 18 | 1 | 2026-01-26 05:19:44 | 2026-01-26 07:30:11 |

**å­—æ®µè¯´æ˜**ï¼š
* `start_block`: å¼€å§‹åŒæ­¥çš„åŒºå—é«˜åº¦
* `token_decimals`: ä»£å¸ç²¾åº¦ï¼ˆ18 è¡¨ç¤º weiï¼‰
* `is_enabled`: æ˜¯å¦å¯ç”¨ï¼ˆ1=å¯ç”¨ï¼Œ0=ç¦ç”¨ï¼‰

---

## æ•°æ®ä¸€è‡´æ€§éªŒè¯

ä»¥ä¸‹ SQL ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚

### 1. ä½™é¢éªŒè¯ (Log vs Snapshot)

**éªŒè¯ç”¨æˆ· 0x5697...1552 åœ¨ Sepolia é“¾çš„ä½™é¢**ï¼š

```sql
-- é€šè¿‡æµæ°´è¡¨é‡å»ºä½™é¢
SELECT SUM(delta) as calculated_balance
FROM balance_log
WHERE chain_id = 11155111 
  AND contract_address = '0xBEfe9d9726c3BFD513b6aDd74B243a82b272C073'
  AND account = '0x569744F510D38d7e8E68829f284AAa7F07611552';
-- ç»“æœ: 450000000000000000000 (450 ä»£å¸)
-- è®¡ç®—è¿‡ç¨‹: 150 + 160 + 70 + 70 = 450

-- å¯¹æ¯”å¿«ç…§è¡¨
SELECT balance FROM user_balance 
WHERE chain_id = 11155111 
  AND contract_address = '0xBEfe9d9726c3BFD513b6aDd74B243a82b272C073'
  AND account = '0x569744F510D38d7e8E68829f284AAa7F07611552';
-- ç»“æœ: 450000000000000000000 (ä¸€è‡´ âœ…)
```

### 2. ç§¯åˆ†éªŒè¯ (Detail vs Total)

**éªŒè¯ç”¨æˆ· 0x5697...1552 åœ¨ Sepolia é“¾çš„ç§¯åˆ†**ï¼š

```sql
-- é€šè¿‡æ˜ç»†è¡¨ç´¯åŠ æ€»ç§¯åˆ†
SELECT SUM(points) as total_points
FROM user_point_log_1
WHERE chain_id = 11155111 
  AND contract_address = '0xBEfe9d9726c3BFD513b6aDd74B243a82b272C073'
  AND account = '0x569744F510D38d7e8E68829f284AAa7F07611552';
-- ç»“æœ: 10065.242

-- å¯¹æ¯”æ€»ç§¯åˆ†è¡¨
SELECT total_points FROM user_point
WHERE chain_id = 11155111 
  AND contract_address = '0xBEfe9d9726c3BFD513b6aDd74B243a82b272C073'
  AND account = '0x569744F510D38d7e8E68829f284AAa7F07611552';
-- ç»“æœ: 10065.242 (ä¸€è‡´ âœ…)
```

### 3. æ—¶é—´è¿ç»­æ€§éªŒè¯

**éªŒè¯ç”¨æˆ·ç§¯åˆ†æ˜ç»†çš„æ—¶é—´è¿ç»­æ€§**ï¼š

```sql
-- æ£€æŸ¥æ˜¯å¦æœ‰æ—¶é—´æ–­å±‚
SELECT 
    t1.id,
    t1.to_time as current_to,
    t2.from_time as next_from,
    TIMESTAMPDIFF(SECOND, t1.to_time, t2.from_time) as gap_seconds
FROM user_point_log_1 t1
LEFT JOIN user_point_log_1 t2 ON t2.id = t1.id + 1 
    AND t2.account = t1.account
WHERE t1.account = '0x569744F510D38d7e8E68829f284AAa7F07611552'
    AND t2.id IS NOT NULL
HAVING gap_seconds != 0;
-- ç»“æœ: ç©ºï¼ˆæ— æ–­å±‚ âœ…ï¼‰
```

---

## æ€»ç»“

æœ¬æ–‡æ¡£å±•ç¤ºäº† Time Ledger ç³»ç»Ÿçš„å®Œæ•´æ•°æ®ç¤ºä¾‹ï¼ŒåŒ…æ‹¬ï¼š

- **20 æ¡ä½™é¢å˜åŠ¨è®°å½•**ï¼šæ¶µç›– 3 ä¸ªç”¨æˆ·åœ¨ 2 æ¡é“¾ä¸Šçš„æ‰€æœ‰è½¬è´¦
- **38 æ¡ç§¯åˆ†æ˜ç»†è®°å½•**ï¼šSepolia 25 æ¡ + Base Sepolia 13 æ¡
- **6 ä¸ªç”¨æˆ·è´¦æˆ·**ï¼šæ¯æ¡é“¾ 3 ä¸ªç”¨æˆ·
- **2 æ¡åŒºå—é“¾**ï¼šSepolia (11155111) å’Œ Base Sepolia (84532)

æ‰€æœ‰æ•°æ®å‡æ¥è‡ªçœŸå®è¿è¡Œçš„ç³»ç»Ÿï¼Œç»è¿‡è„±æ•å¤„ç†åå±•ç¤ºã€‚æ•°æ®ä¹‹é—´çš„å…³è”å…³ç³»å®Œæ•´ï¼Œå¯ç”¨äºéªŒè¯ç³»ç»Ÿçš„æ­£ç¡®æ€§ã€‚
