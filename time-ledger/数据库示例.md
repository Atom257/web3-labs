# æ•°æ®åº“ç¤ºä¾‹æ•°æ®

æœ¬æ–‡æ¡£å±•ç¤ºäº† Time Ledger ç³»ç»Ÿä¸­å„ä¸ªæ ¸å¿ƒè¡¨çš„**å®Œæ•´ç¤ºä¾‹æ•°æ®**ï¼ˆæˆªè‡³ 2026-01-18ï¼‰ï¼Œå¹¶è¯¦ç»†è¯´æ˜äº†å­—æ®µå«ä¹‰ã€ä¸šåŠ¡é€»è¾‘åŠå¹‚ç­‰æ€§è®¾è®¡ã€‚

> **æ•°æ®è¯´æ˜**ï¼š
> 1. æ•°æ®æ¶µç›– **Sepolia (11155111)** å’Œ **Base Sepolia (84532)** ä¸¤æ¡é“¾ã€‚
> 2. ä¸ºä¿è¯è¡¨æ ¼å¯è¯»æ€§ï¼Œé•¿å­—ç¬¦ä¸²ï¼ˆåœ°å€/å“ˆå¸Œï¼‰è¿›è¡Œäº†è„±æ•æ˜¾ç¤ºï¼ˆå¦‚ `0x8a...5Dd1`ï¼‰ï¼Œä½†**è¡Œæ•°å®Œæ•´ï¼Œæ— é—æ¼**ã€‚

---

## 1. balance_log (ä½™é¢å˜åŠ¨äº‹å®è¡¨)

è®°å½•æ‰€æœ‰ ERC20 Transfer äº‹ä»¶å¯¼è‡´çš„ä½™é¢å˜åŠ¨æµæ°´ã€‚è¿™æ˜¯è®¡ç®—ä½™é¢å’Œç§¯åˆ†çš„**åŸå§‹äº‹å®æº**ã€‚

| id | chain_id | contract_address | account | delta | balance_after | block_number | block_time | tx_hash | log_index | created_at |
|---|---|---|---|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 1000 | 1000 | 10032846 | 2026-01-13 05:20:36 | 0x8a68...52b0 | 657 | 2026-01-17 11:50:13 |
| 2 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -100 | 900 | 10034697 | 2026-01-13 11:59:12 | 0x83ed...fc49 | 43 | 2026-01-17 11:53:39 |
| 3 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 100 | 100 | 10034697 | 2026-01-13 11:59:12 | 0x83ed...fc49 | 43 | 2026-01-17 11:53:39 |
| 4 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -150 | 750 | 10034699 | 2026-01-13 11:59:48 | 0x3595...8ecf | 31 | 2026-01-17 11:53:40 |
| 5 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 150 | 150 | 10034699 | 2026-01-13 11:59:48 | 0x3595...8ecf | 31 | 2026-01-17 11:53:40 |
| 6 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -90 | 660 | 10038756 | 2026-01-14 01:54:48 | 0x671e...2117 | 123 | 2026-01-17 12:01:18 |
| 7 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 90 | 190 | 10038756 | 2026-01-14 01:54:48 | 0x671e...2117 | 123 | 2026-01-17 12:01:18 |
| 8 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -160 | 500 | 10038757 | 2026-01-14 01:55:00 | 0x2104...a6e8 | 48 | 2026-01-17 12:01:18 |
| 9 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 160 | 310 | 10038757 | 2026-01-14 01:55:00 | 0x2104...a6e8 | 48 | 2026-01-17 12:01:18 |
| 10 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -310 | 190 | 10046276 | 2026-01-15 03:01:00 | 0x97cc...4a8e | 2 | 2026-01-17 12:15:03 |
| 11 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 310 | 500 | 10046276 | 2026-01-15 03:01:00 | 0x97cc...4a8e | 2 | 2026-01-17 12:15:03 |
| 12 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | -70 | 120 | 10046278 | 2026-01-15 03:01:24 | 0x3e6e...1e12 | 3 | 2026-01-17 12:15:04 |
| 13 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 70 | 380 | 10046278 | 2026-01-15 03:01:24 | 0x3e6e...1e12 | 3 | 2026-01-17 12:15:04 |
| 14 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | -70 | 430 | 10053039 | 2026-01-16 01:47:24 | 0x2081...b2d3 | 25 | 2026-01-17 12:36:50 |
| 15 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 70 | 450 | 10053039 | 2026-01-16 01:47:24 | 0x2081...b2d3 | 25 | 2026-01-17 12:36:50 |
| 16 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 1000 | 1000 | 36258216 | 2026-01-13 06:12:00 | 0x8d18...4732 | 66 | 2026-01-17 14:17:26 |
| 17 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | -110 | 890 | 36268659 | 2026-01-13 12:00:06 | 0x17be...7387 | 107 | 2026-01-17 14:17:26 |
| 18 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 110 | 110 | 36268659 | 2026-01-13 12:00:06 | 0x17be...7387 | 107 | 2026-01-17 14:17:26 |
| 19 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | -130 | 760 | 36268682 | 2026-01-13 12:00:52 | 0xef0c...45e0 | 24 | 2026-01-17 14:17:26 |
| 20 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 130 | 130 | 36268682 | 2026-01-13 12:00:52 | 0xef0c...45e0 | 24 | 2026-01-17 14:17:26 |
| 21 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | -80 | 680 | 36293673 | 2026-01-14 01:53:54 | 0x81d0...525a | 22 | 2026-01-17 14:46:16 |
| 22 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 80 | 190 | 36293673 | 2026-01-14 01:53:54 | 0x81d0...525a | 22 | 2026-01-17 14:46:16 |
| 23 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | -60 | 620 | 36293683 | 2026-01-14 01:54:14 | 0xed12...a565 | 29 | 2026-01-17 14:46:20 |
| 24 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 60 | 190 | 36293683 | 2026-01-14 01:54:14 | 0xed12...a565 | 29 | 2026-01-17 14:46:20 |

**å…³é”®å­—æ®µè¯´æ˜**ï¼š
* `delta`: ä½™é¢å˜åŠ¨é‡ï¼ˆæ­£æ•°=å…¥è´¦ï¼Œè´Ÿæ•°=å‡ºè´¦ï¼‰ã€‚æ•°æ®å­˜å‚¨ä¸º weiï¼Œå±•ç¤ºæ—¶é€šå¸¸é™¤ä»¥ 10^18ã€‚
* `balance_after`: å˜åŠ¨å‘ç”Ÿåçš„ä½™é¢å¿«ç…§ã€‚
* `log_index`: åŒºå—å†…çš„æ—¥å¿—ç´¢å¼•ï¼Œç”¨äºåŒºåˆ†åŒä¸€äº¤æ˜“ä¸­çš„å¤šç¬”è½¬è´¦ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
* `UNIQUE KEY (chain_id, contract_address, tx_hash, log_index, account)`
* **ä½œç”¨**ï¼šä¿è¯é“¾ä¸Šæ¯ä¸€ç¬”è½¬è´¦äº‹ä»¶ï¼ˆTransferï¼‰åœ¨æ•°æ®åº“ä¸­åªè¢«è®°å½•ä¸€æ¬¡ã€‚å³ä½¿ Indexer é‡å¤æ‰«æåŒºå—ï¼Œæ•°æ®åº“ä¹Ÿä¼šè‡ªåŠ¨å¿½ç•¥é‡å¤è®°å½• (`ON CONFLICT DO NOTHING`)ã€‚

---

## 2. block_cursor (åŒæ­¥è¿›åº¦è¡¨)

è®°å½•æ¯æ¡é“¾çš„ Indexer å·¥ä½œè¿›åº¦ã€‚

| id | chain_id | contract_address | block_number | block_hash | scan_block_number | last_block_time | updated_at |
|---|---|---|---|---|---|---|---|
| 4 | 11155111 | 0xBEfe...C073 | 10068265 | 0xafa9...6549 | 10068265 | 2026-01-18 04:36:12.000000 | 2026-01-18 04:37:31.202674 |
| 5 | 84532 | 0xB8a3...3dF6 | 36293683 | 0x3750...0b90 | 36470837 | 2026-01-18 04:19:22.000000 | 2026-01-18 04:38:05.029642 |

**å…³é”®å­—æ®µè¯´æ˜**ï¼š
* `block_number`: **å…¥åº“é«˜åº¦**ã€‚è¡¨ç¤ºè¯¥é«˜åº¦åŠä¹‹å‰çš„äº¤æ˜“å·²å…¨éƒ¨å†™å…¥æ•°æ®åº“ï¼ˆcanonicalï¼‰ã€‚
* `scan_block_number`: **æ‰«æé«˜åº¦**ã€‚è¡¨ç¤º Indexer å·²ç»æ£€æŸ¥è¿‡çš„åŒºå—é«˜åº¦ï¼ˆå¯èƒ½åŒ…å«ç©ºå—ï¼‰ã€‚
* `last_block_time`: **æœ€æ–°å®‰å…¨æ—¶é—´**ã€‚Calculator ä¾èµ–æ­¤å­—æ®µåˆ¤æ–­â€œç°åœ¨â€çš„æ—¶é—´ã€‚

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **OP Stack æ‰«æè¿›åº¦é¢†å…ˆ**ï¼šæ³¨æ„ Chain 84532 çš„ `scan_block_number` (36470837) è¿œå¤§äº `block_number` (36293683)ã€‚è¿™æ˜¯å› ä¸º OP Stack é“¾åŒ…å«å¤§é‡ç©ºå—ï¼ŒIndexer å·²ç»æ‰«æç¡®è®¤äº†åç»­çš„ç©ºå—å¹¶æ›´æ–°äº†æ—¶é—´ï¼Œä½†ç”±äºæ²¡æœ‰æ–°äº¤æ˜“ï¼Œå…¥åº“é«˜åº¦ä¿æŒä¸å˜ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
* `UNIQUE KEY (chain_id, contract_address)`
* **ä½œç”¨**ï¼šç¡®ä¿æ¯ä¸ªåˆçº¦åœ¨æ¯æ¡é“¾ä¸Šåªæœ‰ä¸€è¡Œè¿›åº¦è®°å½•ï¼Œé˜²æ­¢å¹¶å‘ Indexer å®ä¾‹å¯¼è‡´çŠ¶æ€åˆ†è£‚ã€‚

---

## 3. block_header (åŒºå—å¤´ä¿¡æ¯è¡¨)

å­˜å‚¨å…³é”®çš„åŒºå—å“ˆå¸Œä¿¡æ¯ï¼Œç”¨äºæ£€æµ‹é“¾åˆ†å‰ï¼ˆReorgï¼‰ã€‚

| id | chain_id | contract_address | block_number | block_hash | parent_hash | block_time | created_at |
|---|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 10032846 | 0x8b3f...0ac5 | 0xf574...5142 | 2026-01-13 05:20:36.000 | 2026-01-17 11:50:13.994 |
| 2 | 11155111 | 0xBEfe...C073 | 10034697 | 0x60f5...1860 | 0x7ee6...8560 | 2026-01-13 11:59:12.000 | 2026-01-17 11:53:39.762 |
| 3 | 11155111 | 0xBEfe...C073 | 10034699 | 0x09ae...d16b | 0x514f...cd0a | 2026-01-13 11:59:48.000 | 2026-01-17 11:53:40.874 |
| 4 | 11155111 | 0xBEfe...C073 | 10038756 | 0xb239...0452 | 0xd3ed...3042 | 2026-01-14 01:54:48.000 | 2026-01-17 12:01:18.214 |
| 5 | 11155111 | 0xBEfe...C073 | 10038757 | 0x2388...bd61 | 0xb239...0452 | 2026-01-14 01:55:00.000 | 2026-01-17 12:01:18.215 |
| 6 | 11155111 | 0xBEfe...C073 | 10046276 | 0x6c7f...3afd | 0x6284...a4e0 | 2026-01-15 03:01:00.000 | 2026-01-17 12:15:03.038 |
| 7 | 11155111 | 0xBEfe...C073 | 10046278 | 0xb209...3d12 | 0xa682...4688 | 2026-01-15 03:01:24.000 | 2026-01-17 12:15:04.832 |
| 8 | 11155111 | 0xBEfe...C073 | 10053039 | 0x8b26...8718 | 0x25d2...bbd2 | 2026-01-16 01:47:24.000 | 2026-01-17 12:36:50.137 |
| 9 | 84532 | 0xB8a3...3dF6 | 36258216 | 0x3cf5...7eac | 0xcdcf...ba29 | 2026-01-13 06:12:00.000 | 2026-01-17 14:17:26.900 |
| 10 | 84532 | 0xB8a3...3dF6 | 36268659 | 0xb493...e231 | 0x6904...1aae | 2026-01-13 12:00:06.000 | 2026-01-17 14:17:26.917 |
| 11 | 84532 | 0xB8a3...3dF6 | 36268682 | 0x6154...b008 | 0x0af9...7bed | 2026-01-13 12:00:52.000 | 2026-01-17 14:17:26.923 |
| 12 | 84532 | 0xB8a3...3dF6 | 36293673 | 0x0bc7...671b | 0x9e20...93d5 | 2026-01-14 01:53:54.000 | 2026-01-17 14:46:16.028 |
| 13 | 84532 | 0xB8a3...3dF6 | 36293683 | 0x3750...0b90 | 0x40ad...0858 | 2026-01-14 01:54:14.000 | 2026-01-17 14:46:20.576 |

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **åˆ†å‰æ£€æµ‹**ï¼šIndexer å®šæœŸå¯¹æ¯”æœ¬åœ° `block_hash` ä¸é“¾ä¸Š RPC è¿”å›çš„ Hashã€‚å¦‚æœä¸ä¸€è‡´ï¼Œè¯´æ˜å‘ç”Ÿ Reorgï¼Œè§¦å‘å›æ»šé€»è¾‘ã€‚
* **è®°å½•å¯†åº¦**ï¼šä»…è®°å½•**æœ‰äº¤æ˜“**çš„åŒºå—å¤´ï¼Œä»¥èŠ‚çœç©ºé—´ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
* `UNIQUE KEY (chain_id, contract_address, block_number)`
* **ä½œç”¨**ï¼šä¿è¯æ¯ä¸ªåŒºå—é«˜åº¦åªå­˜å‚¨ä¸€ä¸ª Headerã€‚å½“å‘ç”Ÿé‡ç»„æ—¶ï¼Œéœ€å…ˆåˆ é™¤æ—§ Header å†æ’å…¥æ–° Headerã€‚

---

## 4. point_rate (ç§¯åˆ†è´¹ç‡è¡¨)

é…ç½®ä¸åŒæ—¶é—´æ®µçš„ç§¯åˆ†äº§ç”Ÿé€Ÿç‡ã€‚

| id | chain_id | contract_address | rate_numerator | rate_denominator | effective_time | created_at |
|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 5 | 100 | 1970-01-01 00:00:00.000000 | 2026-01-17 11:27:44.370715 |
| 2 | 11155111 | 0xBEfe...C073 | 8 | 100 | 2026-01-15 03:01:00.000000 | 2026-01-17 11:27:44.370715 |
| 3 | 84532 | 0xB8a3...3dF6 | 5 | 100 | 1970-01-01 00:00:00.000000 | 2026-01-17 11:27:44.370715 |
| 4 | 84532 | 0xB8a3...3dF6 | 8 | 100 | 2026-01-15 03:01:00.000000 | 2026-01-17 11:27:44.370715 |

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **è´¹ç‡è®¡ç®—**ï¼š`rate = rate_numerator / rate_denominator` (ä¾‹: 5/100 = 5%)ã€‚
* **æ—¶é—´åˆ‡ç‰‡**ï¼šç§¯åˆ†è®¡ç®—å™¨åœ¨è®¡ç®—æ—¶ï¼Œä¼šæ ¹æ® `effective_time` å°†æ—¶é—´è½´åˆ‡åˆ†ä¸ºä¸åŒåŒºé—´ï¼Œåº”ç”¨ä¸åŒçš„è´¹ç‡ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
* `UNIQUE KEY (chain_id, contract_address, effective_time)`
* **ä½œç”¨**ï¼šé˜²æ­¢åŒä¸€æ—¶é—´ç‚¹å­˜åœ¨å†²çªçš„è´¹ç‡é…ç½®ï¼Œç¡®ä¿ç§¯åˆ†è®¡ç®—çš„ç¡®å®šæ€§ã€‚

---

## 5. user_balance (ç”¨æˆ·ä½™é¢å¿«ç…§è¡¨)

å­˜å‚¨ç”¨æˆ·å½“å‰æ—¶åˆ»çš„ä½™é¢çŠ¶æ€ï¼ˆçƒ­æ•°æ®ï¼‰ã€‚

| id | chain_id | contract_address | account | balance | block_number | block_time | updated_at |
|---|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 120 | 10046278 | 2026-01-15 03:01:24.000000 | 2026-01-17 12:15:04.833196 |
| 2 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 430 | 10053039 | 2026-01-16 01:47:24.000000 | 2026-01-17 12:36:50.139475 |
| 3 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 450 | 10053039 | 2026-01-16 01:47:24.000000 | 2026-01-17 12:36:50.141202 |
| 4 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 620 | 36293683 | 2026-01-14 01:54:14.000000 | 2026-01-17 14:46:20.577001 |
| 5 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 190 | 36293673 | 2026-01-14 01:53:54.000000 | 2026-01-17 14:46:16.030658 |
| 6 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 190 | 36293683 | 2026-01-14 01:54:14.000000 | 2026-01-17 14:46:20.577965 |

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **å®æ—¶æ€§**ï¼šæ¯æ¬¡ Indexer å¤„ç†ä¸€ä¸ªå—ï¼Œéƒ½ä¼šæ›´æ–°æ­¤è¡¨ã€‚
* **å¯é‡å»ºæ€§**ï¼šæ­¤è¡¨å¯éšæ—¶é€šè¿‡ `balance_log` é‡å»ºã€‚å½“å‘ç”Ÿåˆ†å‰å›æ»šæ—¶ï¼Œç³»ç»Ÿä¼šåˆ é™¤æ—§å¿«ç…§å¹¶åˆ©ç”¨ log é‡ç®—ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
* `UNIQUE KEY (chain_id, contract_address, account)`
* **ä½œç”¨**ï¼šä¿è¯æ¯ä¸ªç”¨æˆ·åœ¨æ¯ä¸ªåˆçº¦ä¸‹åªæœ‰ä¸€æ¡ä½™é¢è®°å½•ï¼Œæ”¯æŒå¿«é€Ÿè¦†ç›–æ›´æ–°ã€‚

---

## 6. user_point (ç”¨æˆ·ç§¯åˆ†å¿«ç…§è¡¨)

å­˜å‚¨ç”¨æˆ·å½“å‰ç´¯è®¡çš„æ€»ç§¯åˆ†ã€‚

| id | chain_id | contract_address | account | total_points | last_calc_time | updated_at |
|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 3015.002 | 2026-01-18 04:36:12.000000 | 2026-01-18 04:38:47.805717 |
| 2 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 2188.571 | 2026-01-18 04:36:12.000000 | 2026-01-18 04:38:47.814052 |
| 3 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 2967.027 | 2026-01-18 04:36:12.000000 | 2026-01-18 04:38:47.819281 |
| 4 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 1443.105666666666666700 | 2026-01-18 04:19:22.000000 | 2026-01-18 04:38:47.829352 |
| 5 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 5232.907833333333333300 | 2026-01-18 04:19:22.000000 | 2026-01-18 04:38:47.834694 |
| 6 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 1429.308722222222222300 | 2026-01-18 04:19:22.000000 | 2026-01-18 04:38:47.838726 |

**å…³é”®å­—æ®µè¯´æ˜**ï¼š
* `total_points`: ç”¨æˆ·å†å²æ€»ç§¯åˆ†ã€‚
* `last_calc_time`: **ç§¯åˆ†ç»“ç®—æ°´ä½çº¿**ã€‚ä¸‹æ¬¡è®¡ç®—å°†ä»è¿™ä¸ªæ—¶é—´ç‚¹å¼€å§‹ã€‚æ‰€æœ‰è®°å½•å‡å·²æ›´æ–°è‡³ 1æœˆ18æ—¥ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
* `UNIQUE KEY (chain_id, contract_address, account)`
* **ä½œç”¨**ï¼šæ¯ä¸ªç”¨æˆ·åªæœ‰ä¸€æ¡ç§¯åˆ†è®°å½•ã€‚Calculator é‡‡ç”¨ `INSERT ON DUPLICATE KEY UPDATE` é€»è¾‘æ›´æ–°æ­¤è¡¨ã€‚

---

## 7. user_point_log (ç§¯åˆ†è®¡ç®—æ˜ç»†è¡¨)

è®°å½•æ¯ä¸€æ®µâ€œä½™é¢ä¿æŒä¸å˜çš„æ—¶é—´åŒºé—´â€æ‰€äº§ç”Ÿçš„ç§¯åˆ†ã€‚è¿™æ˜¯ç§¯åˆ†çš„**å®¡è®¡æ˜ç»†**ã€‚

| id | chain_id | contract_address | account | balance | from_time | to_time | points | rate_numerator | rate_denominator | created_at |
|---|---|---|---|---|---|---|---|---|---|---|
| 1 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 150 | 2026-01-13 11:59:48 | 2026-01-14 01:55:00 | 104.400 | 5 | 100 | 2026-01-17 15:31:37.880678 |
| 2 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 310 | 2026-01-14 01:55:00 | 2026-01-15 03:01:00 | 389.050 | 5 | 100 | 2026-01-17 15:31:37.880678 |
| 3 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 310 | 2026-01-15 03:01:00 | 2026-01-15 03:01:24 | 0.165333333333333300 | 8 | 100 | 2026-01-17 15:31:37.880678 |
| 4 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 380 | 2026-01-15 03:01:24 | 2026-01-16 01:47:24 | 692.106666666666666700 | 8 | 100 | 2026-01-17 15:31:37.880678 |
| 5 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 1000 | 2026-01-13 05:20:36 | 2026-01-13 11:59:12 | 332.166666666666666700 | 5 | 100 | 2026-01-17 15:31:37.887567 |
| 6 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 900 | 2026-01-13 11:59:12 | 2026-01-13 11:59:48 | 0.450 | 5 | 100 | 2026-01-17 15:31:37.887567 |
| 7 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 750 | 2026-01-13 11:59:48 | 2026-01-14 01:54:48 | 521.875 | 5 | 100 | 2026-01-17 15:31:37.887567 |
| 8 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 660 | 2026-01-14 01:54:48 | 2026-01-14 01:55:00 | 0.110 | 5 | 100 | 2026-01-17 15:31:37.887567 |
| 9 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 500 | 2026-01-14 01:55:00 | 2026-01-15 03:01:00 | 627.500 | 5 | 100 | 2026-01-17 15:31:37.887567 |
| 10 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 190 | 2026-01-15 03:01:00 | 2026-01-15 03:01:24 | 0.101333333333333300 | 8 | 100 | 2026-01-17 15:31:37.887567 |
| 11 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 120 | 2026-01-15 03:01:24 | 2026-01-16 01:47:24 | 218.560 | 8 | 100 | 2026-01-17 15:31:37.887567 |
| 12 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 100 | 2026-01-13 11:59:12 | 2026-01-14 01:54:48 | 69.633333333333333300 | 5 | 100 | 2026-01-17 15:31:37.892519 |
| 13 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 190 | 2026-01-14 01:54:48 | 2026-01-15 03:01:00 | 238.481666666666666700 | 5 | 100 | 2026-01-17 15:31:37.892519 |
| 14 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 500 | 2026-01-15 03:01:00 | 2026-01-16 01:47:24 | 910.933333333333333300 | 8 | 100 | 2026-01-17 15:31:37.892519 |
| 15 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 130 | 2026-01-13 12:00:52 | 2026-01-14 01:54:14 | 90.281388888888888900 | 5 | 100 | 2026-01-17 15:31:37.909742 |
| 16 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 1000 | 2026-01-13 06:12:00 | 2026-01-13 12:00:06 | 290.083333333333333300 | 5 | 100 | 2026-01-17 15:31:37.914096 |
| 17 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 890 | 2026-01-13 12:00:06 | 2026-01-13 12:00:52 | 0.568611111111111100 | 5 | 100 | 2026-01-17 15:31:37.914096 |
| 18 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 760 | 2026-01-13 12:00:52 | 2026-01-14 01:53:54 | 527.587777777777777800 | 5 | 100 | 2026-01-17 15:31:37.914096 |
| 19 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 680 | 2026-01-14 01:53:54 | 2026-01-14 01:54:14 | 0.188888888888888900 | 5 | 100 | 2026-01-17 15:31:37.914096 |
| 20 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 110 | 2026-01-13 12:00:06 | 2026-01-14 01:53:54 | 76.431666666666666700 | 5 | 100 | 2026-01-17 15:31:37.918421 |
| 21 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 190 | 2026-01-14 01:53:54 | 2026-01-14 01:54:14 | 0.052777777777777800 | 5 | 100 | 2026-01-17 15:31:37.918421 |
| 22 | 11155111 | 0xBEfe...C073 | 0x5697...1552 | 450 | 2026-01-16 01:47:24 | 2026-01-18 04:36:12 | 1829.280000000000000000 | 8 | 100 | 2026-01-18 04:38:47.805717 |
| 23 | 11155111 | 0xBEfe...C073 | 0x8a89...5Dd1 | 120 | 2026-01-16 01:47:24 | 2026-01-18 04:36:12 | 487.808000000000000000 | 8 | 100 | 2026-01-18 04:38:47.814052 |
| 24 | 11155111 | 0xBEfe...C073 | 0xe9FC...c259 | 430 | 2026-01-16 01:47:24 | 2026-01-18 04:36:12 | 1747.978666666666666700 | 8 | 100 | 2026-01-18 04:38:47.819281 |
| 25 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 190 | 2026-01-14 01:54:14 | 2026-01-15 03:01:00 | 238.571388888888888900 | 5 | 100 | 2026-01-18 04:38:47.829352 |
| 26 | 84532 | 0xB8a3...3dF6 | 0x5697...1552 | 190 | 2026-01-15 03:01:00 | 2026-01-18 04:19:22 | 1114.252888888888888900 | 8 | 100 | 2026-01-18 04:38:47.829352 |
| 27 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 620 | 2026-01-14 01:54:14 | 2026-01-15 03:01:00 | 778.496111111111111100 | 5 | 100 | 2026-01-18 04:38:47.834694 |
| 28 | 84532 | 0xB8a3...3dF6 | 0x8a89...5Dd1 | 620 | 2026-01-15 03:01:00 | 2026-01-18 04:19:22 | 3635.983111111111111100 | 8 | 100 | 2026-01-18 04:38:47.834694 |
| 29 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 190 | 2026-01-14 01:54:14 | 2026-01-15 03:01:00 | 238.571388888888888900 | 5 | 100 | 2026-01-18 04:38:47.838726 |
| 30 | 84532 | 0xB8a3...3dF6 | 0xe9FC...c259 | 190 | 2026-01-15 03:01:00 | 2026-01-18 04:19:22 | 1114.252888888888888900 | 8 | 100 | 2026-01-18 04:38:47.838726 |

**ä¸šåŠ¡é€»è¾‘**ï¼š
* **è¿ç»­æ€§**ï¼šå¯¹äºåŒä¸€ä¸ªç”¨æˆ·ï¼Œ`from_time` å¿…é¡»ä¸¥æ ¼ç­‰äºä¸Šä¸€æ¡è®°å½•çš„ `to_time`ï¼ˆid 27, 28 å±•ç¤ºäº†è·¨è¶Šè´¹ç‡å˜æ›´çš„è¿ç»­è®¡ç®—ï¼‰ã€‚
* **å®Œæ•´æ€§**ï¼šæ‰€æœ‰æ—¶é—´æ®µåŠ èµ·æ¥åº”è¦†ç›–ç”¨æˆ·æŒä»“çš„æ¯ä¸€ç§’ã€‚

**ğŸ”‘ å”¯ä¸€ç´¢å¼• (å¹‚ç­‰æ€§ä¿è¯)**ï¼š
* `UNIQUE KEY (chain_id, contract_address, account, from_time, to_time)`
* **ä½œç”¨**ï¼šé˜²æ­¢åŒä¸€æ—¶é—´æ®µè¢«é‡å¤è®¡ç®—ç§¯åˆ†ã€‚

---

## æ•°æ®ä¸€è‡´æ€§éªŒè¯

ä»¥ä¸‹ SQL ç”¨äºéªŒè¯**ç”¨æˆ· 0x5697...1552** åœ¨ OP Stack é“¾ (84532) çš„æ•°æ®å®Œæ•´æ€§ã€‚

### 1. ä½™é¢éªŒè¯ (Log vs Snapshot)

```sql
-- é€šè¿‡æµæ°´è¡¨é‡å»ºä½™é¢
SELECT SUM(delta) as calculated_balance
FROM balance_log
WHERE chain_id = 84532 
  AND account = '0x569744F510D38d7e8E68829f284AAa7F07611552';
-- ç»“æœ: 190
-- è®¡ç®—è¿‡ç¨‹: 130 + 60 = 190

-- å¯¹æ¯”å¿«ç…§è¡¨
SELECT balance FROM user_balance 
WHERE chain_id = 84532 AND account = '0x569744F510D38d7e8E68829f284AAa7F07611552';
-- ç»“æœ: 190 (ä¸€è‡´ âœ…)

### 2. ç§¯åˆ†éªŒè¯ (Detail vs Total)

```sql
-- é€šè¿‡æ˜ç»†è¡¨ç´¯åŠ æ€»ç§¯åˆ†
SELECT SUM(points) as total_points
FROM user_point_log
WHERE chain_id = 84532 
  AND account = '0x569744F510D38d7e8E68829f284AAa7F07611552';
-- ç»“æœ: 1443.1056666666666667
-- æ˜ç»†: 
-- id=15 (æ—©æœŸ): 90.281388888888888900
-- id=25 (è¡¥ç®—5%): 238.571388888888888900
-- id=26 (è¡¥ç®—8%): 1114.252888888888888900

-- å¯¹æ¯”æ€»ç§¯åˆ†è¡¨
SELECT total_points FROM user_point
WHERE chain_id = 84532 AND account = '0x569744F510D38d7e8E68829f284AAa7F07611552';
-- ç»“æœ: 1443.1056666666666667 (ä¸€è‡´ âœ…)